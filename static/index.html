<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<title>Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ø·Ø¨ÙŠØ© â€” Ø§Ù„Ø£Ù‡Ù„ÙŠ Ù„Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
  body{font-family:Tahoma, Arial, sans-serif;background:#f7f7f7;margin:0}
  .container{max-width:980px;margin:auto;padding:16px}
  .section{background:#fff;border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,.06);padding:16px;margin:12px 0}
  h2{margin:6px 0 12px}
  textarea,input[type="text"]{width:100%;padding:12px;border:1px solid #ddd;border-radius:8px}
  button{width:100%;background:#006a4e;color:#fff;border:0;border-radius:10px;padding:12px;cursor:pointer;font-weight:bold}
  button:hover{opacity:.95}
  .muted{color:#666;font-size:13px}
  .loader{display:none;border:4px solid #eee;border-top:4px solid #006a4e;border-radius:50%;width:28px;height:28px;animation:spin 1s linear infinite;margin:10px auto}
  @keyframes spin{100%{transform:rotate(360deg)}}

  .card{border:1px solid #e7e7e7;border-radius:12px;padding:12px;margin:10px 0;background:#fff}
  .card.best{border:2px solid #006a4e;box-shadow:0 0 0 4px rgba(0,106,78,.08)}
  .badge{display:inline-flex;align-items:center;gap:6px;background:#006a4e;color:#fff;border-radius:999px;padding:4px 10px;font-size:12px;margin-bottom:8px}
  .stars{color:#ffc107}
  .row{display:flex;gap:10px;align-items:flex-start}
  .icon{width:44px;height:44px;border-radius:50%;background:#e7f1ed;display:inline-flex;align-items:center;justify-content:center;color:#006a4e;font-size:20px}
  .title{font-weight:bold}
  .small{font-size:12px;color:#666}
  .pill{display:inline-block;background:#f3f5f7;border-radius:999px;padding:2px 8px;margin:2px 4px}
  .actions a{display:inline-block;margin:4px;padding:10px;border-radius:10px;background:#f1f1f1;color:#006a4e;text-decoration:none}
  .actions a:hover{background:#006a4e;color:#fff}
  .map-wrap{position:relative;border-radius:12px;overflow:hidden}
  .map-wrap::after{content:"Ø§Ø¶ØºØ· Ù„ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙÙŠ Ø§Ù„Ø®Ø±Ø§Ø¦Ø·";position:absolute;bottom:6px;right:6px;background:rgba(0,106,78,.85);color:#fff;padding:4px 8px;border-radius:6px;font-size:12px}
  .divider{height:1px;background:#eee;margin:12px 0}
  .hint{background:#fff9e6;border:1px solid #ffe08a;color:#7a5d00;padding:8px;border-radius:8px;font-size:13px}
</style>
</head>
<body>

<div class="container">

  <!-- Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ -->
  <div class="section" id="search">
    <h2>ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªÙ‚Ø¯Ù… ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ø·Ø¨ÙŠØ©</h2>
    <div class="muted">Ø§ÙƒØªØ¨ Ø­Ø§Ø³Ø³ Ø¨Ø¥ÙŠÙ‡ (Ø¨Ø§Ù„Ø¹Ø§Ù…ÙŠØ©/Ø§Ù„Ø¹Ø±Ø¨ÙŠ/Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ) ÙˆÙ‚ÙˆÙ„Ù†Ø§ Ø§Ù†Øª ÙÙŠÙ† â€” Ù‡Ù†Ø±Ø´Ù‘Ø­ Ù„Ùƒ Ø§Ù„ØªØ®ØµØµ ÙˆØ§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª Ø§Ù„Ù‚Ø±ÙŠØ¨Ø©.</div>
    <div style="margin-top:10px"></div>
    <textarea id="symptoms" rows="3" placeholder="Ù…Ø«Ø§Ù„: ØªØ¹Ø¨Ø§Ù† Ø£ÙˆÙŠ ÙˆÙ…ØµØ¯Ø¹ / severe headache"></textarea>
    <div style="height:10px"></div>
    <input id="place" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø·Ø§Ù„Ø¨ÙŠØ© Ù‡Ø±Ù…ØŒ Ø§Ù„Ø¬ÙŠØ²Ø©">
    <div style="height:10px"></div>
    <button id="btn-symptoms"><i class="fa-solid fa-robot"></i> Ø§Ø¨Ø­Ø« Ø§Ù„Ø¢Ù†</button>
    <div id="load-sym" class="loader"></div>
    <div class="hint" style="margin-top:10px">
      Ù…Ø«Ø§Ù„ ÙƒØªØ§Ø¨Ø©: <b>Ø£Ù†Ø§ ÙÙŠ Ø§Ù„Ø¬ÙŠØ²Ø©</b> + <b>Ø­Ø§Ø³Ø³ Ø¨Ø¥Ø±Ù‡Ø§Ù‚ Ø¹Ø§Ù… ÙˆØµØ¯Ø§Ø¹ Ø´Ø¯ÙŠØ¯</b> â€” Ø§Ù„Ù†Ø¸Ø§Ù… Ù‡ÙŠÙÙ‡Ù… Ø§Ù„Ø³ÙŠØ§Ù‚ ÙˆÙŠÙ‚ØªØ±Ø­ Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ØŒ ÙˆÙŠØ·Ù„Ø¹ Ø£Ù‚Ø±Ø¨ Ù…Ù‚Ø¯Ù… Ø®Ø¯Ù…Ø©.
    </div>
  </div>

  <!-- ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
  <div class="section">
    <h2>ğŸ§¾ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„ØªØ­Ø§Ù„ÙŠÙ„</h2>
    <div class="muted">Ø§Ø±ÙØ¹ ØªÙ‚Ø§Ø±ÙŠØ±Ùƒ (Ø£ÙŠ ØµÙŠØºØ©: ØµÙˆØ±/ PDF...) â€” Ù‡Ù†Ø­Ù„Ù‘Ù„Ù‡Ø§ ÙˆÙ†Ø±Ø´Ù‘Ø­ ØªØ®ØµØµ ÙˆÙ…Ù‚Ø¯Ù… Ø®Ø¯Ù…Ø© Ù‚Ø±ÙŠØ¨.</div>
    <div style="height:10px"></div>
    <input id="rep-place" type="text" placeholder="Ù…ÙƒØ§Ù†Ùƒ â€” Ù…Ø«Ø§Ù„: Ø§Ù„Ø¬ÙŠØ²Ø©">
    <div style="height:6px"></div>
    <input id="rep-files" type="file" multiple>
    <div style="height:10px"></div>
    <button id="btn-analyze"><i class="fa-solid fa-file-medical"></i> Ø­Ù„Ù‘Ù„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
    <div id="load-ana" class="loader"></div>
  </div>

  <!-- Ù…Ø®Ø±Ø¬Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ -->
  <div class="section" id="ai-out" style="display:none"></div>

  <!-- Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
  <div class="section" id="results" style="display:none">
    <h3>ğŸ“‹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©</h3>
    <div id="cards"></div>
  </div>

  <!-- Ø§Ù„Ù…Ù‚Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
  <div class="section" id="hq">
    <h2>ğŸ“ Ø§Ù„Ù…Ù‚Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ â€” Ø§Ù„Ø£Ù‡Ù„ÙŠ Ù„Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©</h2>
    <div class="map-wrap" id="hq-map" title="Ø§ÙØªØ­ ÙÙŠ Ø®Ø±Ø§Ø¦Ø· Google">
      <!-- Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ù‚Ø±: 57 Ø¨Ø±Ø¬ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©ØŒ Ø´Ø§Ø±Ø¹ Ù…Ø±Ø§Ø¯ØŒ Ù…ÙŠØ¯Ø§Ù† Ø§Ù„Ù†Ù‡Ø¶Ø©ØŒ Ø§Ù„Ø¬ÙŠØ²Ø© -->
      <iframe
        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3454.495955148021!2d31.20786357555355!3d30.02262187493399!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x145846e49123862b%3A0x12f5a6396017366d!2s57%20El%20Gamaa%20Tower%2C%20Mourad%20St.%20El%20Nahda%20Sq.%2C%20Giza!5e0!3m2!1sen!2seg!4v0000000000000"
        width="100%" height="320" style="border:0" allowfullscreen="" loading="lazy"
        referrerpolicy="no-referrer-when-downgrade"></iframe>
    </div>
    <div style="height:6px"></div>
    <div class="muted">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: 57 Ø¨Ø±Ø¬ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©ØŒ Ø´Ø§Ø±Ø¹ Ù…Ø±Ø§Ø¯ØŒ Ù…ÙŠØ¯Ø§Ù† Ø§Ù„Ù†Ù‡Ø¶Ø©ØŒ Ø§Ù„Ø¬ÙŠØ²Ø©</div>
  </div>

</div>

<script>
  // ===== Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„ØªØ®ØµØµØ§Øª (Ø³ØªØ§ÙŠÙ„ Ù‚Ø¯ÙŠÙ…/Ø¨Ø³ÙŠØ· ÙˆØ¨Ø±ÙˆÙØ´Ù†Ø§Ù„) =====
  const iconMap = {
    "default":"fa-user-doctor",
    "Ø¨Ø§Ø·Ù†Ù‡":"fa-stethoscope",
    "Ù‚Ù„Ø¨":"fa-heart-pulse","Ù‚Ù„Ø¨ÙŠÙ‡":"fa-heart-pulse",
    "ØµØ¯Ø±":"fa-lungs",
    "Ù…Ø®":"fa-brain","Ø§Ø¹ØµØ§Ø¨":"fa-brain",
    "Ù†Ø³Ø§Ø¡":"fa-person-pregnant","Ø§Ø·ÙØ§Ù„":"fa-child-reaching",
    "Ø¹ÙŠÙˆÙ†":"fa-eye","Ø¬Ù„Ø¯ÙŠÙ‡":"fa-hand-dots",
    "Ø¹Ø¸Ø§Ù…":"fa-bone",
    "Ø§Ù†Ù":"fa-head-side-cough","Ø§Ø°Ù†":"fa-head-side-cough","Ø­Ù†Ø¬Ø±Ù‡":"fa-head-side-cough",
    "Ù…Ø³Ø§Ù„Ùƒ":"fa-toilet-paper",
    "Ø§Ø³Ù†Ø§Ù†":"fa-tooth",
    "ØµÙŠØ¯Ù„ÙŠÙ‡":"fa-pills",
    "Ø§Ø´Ø¹Ù‡":"fa-x-ray",
    "Ù…Ø¹Ù…Ù„":"fa-vial",
    "Ù…Ø³ØªØ´ÙÙ‰":"fa-hospital"
  };
  function getIconClass(txt){
    const s = (txt||"").toLowerCase();
    for (const k in iconMap) {
      if (k !== "default" && s.includes(k)) return "fa-solid " + iconMap[k];
    }
    return "fa-solid " + iconMap["default"];
  }

  // ===== Ù…ÙƒÙˆÙ‘Ù†Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ =====
  function showAI(data){
    const box = document.getElementById("ai-out");
    box.style.display = "block";
    box.innerHTML = `
      <div><b>ğŸ’¡ Ø§Ù„Ø´Ø±Ø­ Ø§Ù„Ø·Ø¨ÙŠ:</b> ${data.doctor_explanation || data.interpretation || "-"}</div>
      <div class="divider"></div>
      <div><b>ğŸ©º Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ø£Ù†Ø³Ø¨:</b> ${data.recommended_specialty || "-"} ${data.resolved_location?`â€” Ø¨Ø§Ù„Ù‚Ø±Ø¨ Ù…Ù† <b>${data.resolved_location}</b>`:""}</div>
      <div class="divider"></div>
      <div><b>ğŸ“Œ Ù†ØµØ§Ø¦Ø­ Ù…Ø¨Ø¯Ø¦ÙŠØ©:</b>
        <ul>${(data.temporary_advice||[]).map(x=>`<li>${x}</li>`).join("")}</ul>
      </div>
    `;
  }

  function phonesPills(phones){
    return (phones||[]).map(p=>`<span class="pill">${p}</span>`).join("");
  }

  function showProviders(list){
    const wrap = document.getElementById("cards");
    wrap.innerHTML = "";
    document.getElementById("results").style.display = "block";
    list.forEach(p=>{
      const ico = getIconClass((p.specialty_sub||"") + " " + (p.provider_type||""));
      wrap.innerHTML += `
        <div class="card ${p.best?"best":""}" id="${p.id}">
          ${p.best?`<div class="badge"><i class="fa-solid fa-star stars"></i> Ø§Ù„ØªØ±Ø´ÙŠØ­ Ø§Ù„Ø£Ù†Ø³Ø¨ <span class="stars">â˜…â˜…â˜…â˜…â˜…</span></div>`:""}
          <div class="row">
            <div class="icon"><i class="${ico}"></i></div>
            <div>
              <div class="title">${p.name||"-"}</div>
              <div class="small">${(p.specialty_sub||p.provider_type||"-")}</div>
            </div>
          </div>
          <div class="divider"></div>
          <div><i class="fa-solid fa-location-dot"></i> ${p.address||"-"} <span class="small">(${p.governorate||"-"})</span></div>
          <div style="margin-top:6px"><i class="fa-solid fa-phone"></i> ${phonesPills(p.phones)}</div>
          ${p.hotline?`<div style="margin-top:6px"><i class="fa-solid fa-fire"></i> Hotline: <b>${p.hotline}</b></div>`:""}
          <div class="divider"></div>
          <div class="actions">
            <a href="#search" title="Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¨Ø­Ø«"><i class="fa-solid fa-arrow-up"></i></a>
            <a target="_blank" href="${p.maps_url}" title="Ø§ÙØªØ­ GPS/Ø®Ø±Ø§Ø¦Ø· Google"><i class="fa-solid fa-location-arrow"></i></a>
            <a href="#hq" title="Ø§Ù„Ø°Ù‡Ø§Ø¨ Ø¥Ù„Ù‰ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ù‚Ø±"><i class="fa-solid fa-arrow-down"></i></a>
          </div>
        </div>
      `;
    });
    // Ù†Ø²ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ø£ÙˆÙ‘Ù„ Ù†ØªÙŠØ¬Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¨Ø­Ø«
    if (list.length){ location.hash = "#" + list[0].id; }
  }

  // ===== Ø§Ø³ØªØ¯Ø¹Ø§Ø¡Ø§Øª API =====
  document.getElementById("btn-symptoms").onclick = async () => {
    const s = document.getElementById("symptoms").value.trim();
    const l = document.getElementById("place").value.trim();
    if (!s){ alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒØªØ¨ Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶."); return; }
    if (!l){ alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒØªØ¨ Ù…ÙƒØ§Ù†Ùƒ (Ù…Ø«Ø§Ù„: Ø§Ù„Ø·Ø§Ù„Ø¨ÙŠØ© Ù‡Ø±Ù…ØŒ Ø§Ù„Ø¬ÙŠØ²Ø©)."); return; }
    document.getElementById("load-sym").style.display = "block";
    const res = await fetch("/api/symptoms", {
      method:"POST", headers:{"Content-Type":"application/json"},
      body: JSON.stringify({symptoms:s, location:l})
    });
    const data = await res.json();
    document.getElementById("load-sym").style.display = "none";
    showAI(data);
    showProviders(data.providers || []);
  };

  document.getElementById("btn-analyze").onclick = async () => {
    const l = document.getElementById("rep-place").value.trim();
    if (!l){ alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒØªØ¨ Ù…ÙƒØ§Ù†Ùƒ (Ù…Ø«Ø§Ù„: Ø§Ù„Ø¬ÙŠØ²Ø©)."); return; }
    const files = document.getElementById("rep-files").files;
    if (!files.length){ alert("Ø§Ø±ÙØ¹ Ù…Ù„Ù Ø£Ùˆ Ø£ÙƒØ«Ø± Ù„Ù„ØªØ­Ù„ÙŠÙ„."); return; }
    const arr = [];
    for (const f of files){
      const buf = await f.arrayBuffer();
      const b64 = btoa(String.fromCharCode(...new Uint8Array(buf)));
      arr.push({mime_type: f.type || "application/octet-stream", data: b64});
    }
    document.getElementById("load-ana").style.display = "block";
    const res = await fetch("/api/reports", {
      method:"POST", headers:{"Content-Type":"application/json"},
      body: JSON.stringify({files:arr, location:l})
    });
    const data = await res.json();
    document.getElementById("load-ana").style.display = "none";
    showAI(data);
    showProviders(data.providers || []);
  };

  // Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ù‚Ø± â€” ÙØªØ­ GPS Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ·
  document.getElementById("hq-map").onclick = () => {
    window.open(
      "https://www.google.com/maps/search/?api=1&query=" + encodeURIComponent("57 El Gamaa Tower, Mourad St., El Nahda Sq., Giza, Egypt"),
      "_blank"
    );
  };
</script>
</body>
</html>
