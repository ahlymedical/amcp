<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>الشبكة الطبية - الأهلي للخدمات الطبية</title>
<!-- Font Awesome Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
    :root {
        --primary-green: #006A4E;
        --primary-orange: #F58220;
        --special-green-teal: #008080;
        --accent-light-green: #E6F0ED;
        --white: #ffffff;
        --light-gray: #f0f2f5;
        --medium-gray: #e9ecef;
        --text-dark: #212529;
        --text-muted: #6c757d;
        --danger-red: #dc3545;
        --primary-glow: rgba(0, 106, 78, 0.3);
        --star-yellow: #FFC107;
    }
    html { scroll-behavior: smooth; }
    body {
        font-family: 'Cairo', sans-serif;
        background-color: var(--light-gray);
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        color: var(--text-dark);
        line-height: 1.7;
    }
    .logo-container-full-width, .page, .info-professional, .feature-box {
        width: 100%;
        max-width: 900px;
        box-sizing: border-box;
    }
    .logo-container-full-width { background: var(--white); text-align: center; padding: 20px 0; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .logo-image { max-width: 100%; height: auto; }
    .page { background: var(--white); padding: 25px; box-shadow: 0 5px 30px rgba(0,0,0,0.1); border-radius: 15px; margin: 20px 15px; }
    .info-professional { background-color: var(--accent-light-green); border-radius: 10px; padding: 20px; margin-bottom: 25px; text-align: right; border: 1px solid var(--medium-gray); }
    .info-professional h1 { font-size: 20px; margin: 0 0 5px; color: var(--primary-green); }
    .info-professional .en-title { font-family: 'Poppins', sans-serif; font-size: 14px; color: var(--text-muted); margin-bottom: 20px; display: block; }
    .info-professional .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
    .info-item { display: flex; align-items: center; gap: 15px; }
    .info-item i { font-size: 22px; color: var(--primary-orange); width: 25px; text-align: center; }
    
    .feature-box { text-align: right; margin-bottom: 25px; padding: 20px; background-color: var(--accent-light-green); border: 1px solid var(--medium-gray); border-radius: 10px; }
    .feature-box h2 { font-size: 18px; color: var(--primary-green); margin: 0 0 5px; }
    .feature-box h2 .en-subtitle { font-family: 'Poppins', sans-serif; font-size: 13px; font-weight: 400; color: var(--text-muted); display: block; margin-top: 2px; }
    .feature-box p { font-size: 14px; color: var(--text-muted); margin-bottom: 20px; }
    .feature-box textarea, .feature-box input[type="text"] { width: 100%; padding: 12px 15px; border-radius: 8px; border: 1px solid #ccc; font-family: 'Cairo', sans-serif; font-size: 14px; box-sizing: border-box; background-color: var(--white); margin-bottom: 10px; }
    .feature-box button { background-color: var(--primary-green); color: var(--white); border: none; padding: 12px 25px; font-size: 16px; font-weight: 600; border-radius: 8px; cursor: pointer; transition: all 0.3s; width: 100%; margin-top: 10px; }
    .feature-box button:hover:not(:disabled) { background-color: #005a41; }
    .feature-box button:disabled { background-color: #999; cursor: not-allowed; }
    #ai-search-btn { background-color: var(--special-green-teal); }
    #ai-search-btn:hover:not(:disabled) { background-color: #006666; }

    .loader { border: 4px solid var(--medium-gray); border-top: 4px solid var(--primary-green); border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 20px auto; display: none; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    
    .section-title { font-size: 22px; color: var(--primary-green); padding-bottom: 10px; margin-bottom: 20px; border-bottom: 3px solid var(--primary-orange); }
    
    .provider-card { display: flex; flex-direction: column; gap: 12px; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border: 1px solid var(--medium-gray); transition: all 0.3s; padding: 15px; background-color: var(--white); }
    .provider-name { font-size: 17px; font-weight: 700; color: var(--primary-green); }
    .provider-details, .provider-contact { display: flex; flex-direction: column; gap: 8px; font-size: 14px; color: var(--text-muted); }
    .provider-details span, .provider-contact span { display: flex; align-items: flex-start; gap: 10px; }
    .provider-details i, .provider-contact i { color: var(--primary-orange); width: 16px; text-align: center; margin-top: 4px; }
    
    .provider-nav { display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px; padding-top: 10px; border-top: 1px solid var(--medium-gray); }
    .nav-btn { background-color: var(--accent-light-green); border: 1px solid var(--medium-gray); color: var(--primary-green); width: 38px; height: 38px; border-radius: 50%; cursor: pointer; transition: all 0.2s; font-size: 16px; display: flex; align-items: center; justify-content: center; text-decoration: none; }
    .nav-btn:hover { background-color: var(--primary-green); color: var(--white); transform: scale(1.1); }
    .nav-btn.gps-btn { background-color: var(--primary-orange); color: white; }
    .nav-btn.gps-btn:hover { background-color: #d9711c; }

    #no-results { text-align: center; padding: 40px 20px; background-color: var(--accent-light-green); border-radius: 8px; color: var(--text-muted); font-weight: 600; display: none; }
    
    .best-match-card { border: 2px solid var(--primary-green); box-shadow: 0 0 20px var(--primary-glow); position: relative; overflow: hidden; }
    .best-match-header { background-color: var(--primary-green); color: white; padding: 8px 15px; font-weight: 700; font-size: 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 6px 6px 0 0; margin: -15px -15px 15px -15px; }
    .best-match-header .stars { color: var(--star-yellow); }
</style>
</head>
<body>

<div class="logo-container-full-width">
    <img src="https://i.ibb.co/JFMjRLSf/Cover-Linkedin-AMC-new.png" alt="AMC Logo" class="logo-image">
</div>

<div class="page" id="page-top">
    
    <div class="info-professional">
        <!-- ... (قسم المعلومات يبقى كما هو) ... -->
    </div>

    <!-- AI Search Section -->
    <div class="feature-box">
        <h2><i class="fa-solid fa-robot"></i> استخدم المساعد الذكي <span class="en-subtitle">AI Assistant Tools</span></h2>
        
        <p>فقط أخبرنا بما تحتاجه ومكانك، وسيقوم المساعد الذكي بالبحث عن أنسب مقدم خدمة لك.</p>
        <textarea id="ai-search-input" placeholder="مثال: دكتور عظام في الطالبية، هرم أو صيدلية تعمل 24 ساعة في مصر الجديدة"></textarea>
        <button id="ai-search-btn"><i class="fa-solid fa-magnifying-glass-location"></i> ابحث بالذكاء الاصطناعي</button>
        <div id="loader-ai-search" class="loader"></div>
        
        <hr style="margin: 25px 0; border: 0; border-top: 1px solid var(--medium-gray);">
        
        <p>أو يمكنك وصف أعراضك ومكانك، وسنقوم بترشيح الأفضل لك.</p>
        <textarea id="symptoms-input" placeholder="اكتب الأعراض هنا..."></textarea>
        <input type="text" id="location-input" placeholder="اكتب منطقتك هنا...">
        <button id="symptoms-search-btn">✨ أرشدني بناءً على الأعراض والمكان</button>
        <div id="loader-symptoms-search" class="loader"></div>

        <hr style="margin: 25px 0; border: 0; border-top: 1px solid var(--medium-gray);">
        
        <p>هل لديك تقارير طبية؟ ارفعها ليقوم المساعد الذكي بتحليلها.</p>
        <div class="upload-area" id="upload-area">
            <!-- ... (جزء رفع الملفات يبقى كما هو) ... -->
        </div>
        <div id="file-preview-container"></div>
        <button id="analyze-reports-btn" disabled><i class="fa-solid fa-microscope"></i> حلل التقارير</button>
    </div>

    <!-- Search Results Content -->
    <div id="results-container"></div>
    <div id="no-results">
        <i class="fa-solid fa-box-open" style="font-size: 40px; margin-bottom: 15px;"></i>
        <p>لا توجد نتائج مطابقة لبحثك.</p>
    </div>
    
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    
    // --- Elements ---
    const aiSearchInput = document.getElementById('ai-search-input');
    const aiSearchBtn = document.getElementById('ai-search-btn');
    const symptomsInput = document.getElementById('symptoms-input');
    const locationInput = document.getElementById('location-input');
    const symptomsSearchBtn = document.getElementById('symptoms-search-btn');
    const resultsContainer = document.getElementById('results-container');
    const noResultsDiv = document.getElementById('no-results');

    // --- Helper Functions ---
    const toggleLoader = (loaderId, show) => {
        document.getElementById(loaderId).style.display = show ? 'block' : 'none';
    };

    function createProviderCardHTML(provider, isBestMatch = false) {
        const bestMatchHeader = isBestMatch ? `
            <div class="best-match-header">
                <span>الترشيح الأنسب لك</span>
                <span class="stars"><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i></span>
            </div>` : '';

        const gpsLink = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(provider.name + ', ' + provider.address)}`;
        let phonesHTML = provider.phones && provider.phones.length > 0 ? provider.phones.map(phone => `<span><i class="fa-solid fa-phone"></i> ${phone}</span>`).join('') : '';
        let hotlineHTML = provider.hotline ? `<span><i class="fa-solid fa-headset"></i> ${provider.hotline}</span>` : '';

        return `
            <div class="provider-card ${isBestMatch ? 'best-match-card' : ''}">
                ${bestMatchHeader}
                <div class="provider-name">${provider.name || ''}</div>
                <div class="provider-details">
                    <span><i class="fa-solid fa-location-dot"></i> ${provider.address || ''}</span>
                    <span><i class="fa-solid fa-tag"></i> ${provider.provider_type || ''} / ${provider.specialty_sub || ''}</span>
                </div>
                <div class="provider-contact">${phonesHTML}${hotlineHTML}</div>
                <div class="provider-nav">
                    <a href="${gpsLink}" target="_blank" class="nav-btn gps-btn" title="الاتجاهات على الخريطة"><i class="fa-solid fa-diamond-turn-right"></i></a>
                </div>
            </div>`;
    }

    function renderResults(results) {
        let finalHTML = '';
        if (results.suggested_specialty) {
            finalHTML += `<h2 class="section-title">نرشح لك تخصص: ${results.suggested_specialty}</h2>`;
        }
        if (results.best_match && results.best_match.length > 0) {
            finalHTML += createProviderCardHTML(results.best_match[0], true);
        }
        if (results.other_results && results.other_results.length > 0) {
            if (results.best_match && results.best_match.length > 0) {
                finalHTML += '<h3 class="section-title" style="margin-top: 30px;">نتائج أخرى مطابقة</h3>';
            }
            results.other_results.forEach(provider => { finalHTML += createProviderCardHTML(provider, false); });
        }
        resultsContainer.innerHTML = finalHTML;
        noResultsDiv.style.display = finalHTML === '' ? 'block' : 'none';
    }

    // --- Event Handlers ---
    async function handleAISearch() {
        const query = aiSearchInput.value.trim();
        if (!query) { alert('من فضلك، أدخل الخدمة والمنطقة التي تبحث عنها.'); return; }
        toggleLoader('loader-ai-search', true);
        resultsContainer.innerHTML = '';
        noResultsDiv.style.display = 'none';
        aiSearchBtn.disabled = true;

        try {
            const response = await fetch('/api/ai-search', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ query })
            });
            if (!response.ok) throw new Error('فشل الاتصال بالخادم.');
            const results = await response.json();
            renderResults(results);
        } catch (error) {
            resultsContainer.innerHTML = `<p style="color:var(--danger-red); text-align:center;">عفواً، حدث خطأ: ${error.message}</p>`;
        } finally {
            toggleLoader('loader-ai-search', false);
            aiSearchBtn.disabled = false;
        }
    }

    async function handleSymptomsSearch() {
        const symptoms = symptomsInput.value.trim();
        const location = locationInput.value.trim();
        if (!symptoms || !location) { alert('من فضلك، أدخل الأعراض ومكانك.'); return; }
        toggleLoader('loader-symptoms-search', true);
        resultsContainer.innerHTML = '';
        noResultsDiv.style.display = 'none';
        symptomsSearchBtn.disabled = true;

        try {
            const response = await fetch('/api/symptoms-search', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ symptoms, location })
            });
            if (!response.ok) throw new Error('فشل الاتصال بالخادم.');
            const results = await response.json();
            renderResults(results);
        } catch (error) {
            resultsContainer.innerHTML = `<p style="color:var(--danger-red); text-align:center;">عفواً، حدث خطأ: ${error.message}</p>`;
        } finally {
            toggleLoader('loader-symptoms-search', false);
            symptomsSearchBtn.disabled = false;
        }
    }

    // --- Event Listeners ---
    aiSearchBtn.addEventListener('click', handleAISearch);
    symptomsSearchBtn.addEventListener('click', handleSymptomsSearch);
    
    // ... (كود رفع الملفات يبقى كما هو) ...

});
</script>
</body>
</html>
